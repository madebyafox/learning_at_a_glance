<canvas id="canvas"></canvas>
<script src="SAT.js"></script>

<style>
* { margin:0; padding:0; } /* to remove the top and left whitespace */
html, body { width:100%; height:100%; } /* just to be sure these are full screen*/
canvas { display:block; } /* To remove the scrollbars */
</style>

<script>
(function() 
{
		//DECLARE GLOBAL VARS
		var canvas = document.getElementById('canvas'),context = canvas.getContext('2d');  //create the canvas
  	var collider_circles = [];  //create the array of colliders (area of interest/tigger zones)
		var lastRegion = -1; //variable to hold the last region the mouse was in
		var sounds = []; //array to store audio objects
		mouse_point = new SAT.Vector(0, 0);  //declare a vector to contain the mouse coordinates
    
		//DO THE MAIN STUFF
		window.addEventListener('resize', resizeCanvas, false);     // resize the canvas to fill browser window dynamically
    setInterval(function() { update(collider_circles,mouse_point); },100);  //set the logging interval
    document.onmousemove = function(mouse) //define what happens when the mouse moves
		{
        mouse_point.x = mouse.clientX;
        mouse_point.y = mouse.clientY;
    }
		drawStuff(); //draw the stimuli to the canvas
		
		//----------------------
		//ONLY CALLED IF WINDOW IS RESIZED (AUTOMATICALLY BASED ON EVENT LISTENER)
		//----------------------
    function resizeCanvas() 
		{
			drawStuff(); //redraw the content if the window is resized
    }
   
		//----------------------
		//CALLED ONCE ON PAGE LOAD + ON EVERY RESIZE
		//----------------------
    function drawStuff() 
		{ 
      	canvas.width  = window.innerWidth;
      	canvas.height = window.innerHeight;
        var winW = window.innerWidth;
        var winH = window.innerHeight;
        var nrows = 3;
        var ncols = 3;
        var radius = 60;
        var pics = ["cod", "haddock", "halibut", "herring", "lesser.weaver", "mackeral","monkfish","salmon","scab"];
        var counter = 0;
				var images = {};
        for (i = 1; i <= nrows; i++) 
				{ 
            for (z = 1; z <= ncols; z++) 
						{
                var right = (i/ncols)*winW - (1/(nrows*2))*winW;
                var down =  (z/nrows)*winH - (1/(ncols*2))*winH;
                var the_point = new SAT.Vector(right,down);
                //drawCircle(right,down,radius); //so we can see the trigger areas
                
                //now we create an array of collider objects to trigger events from mouse or gaze
                collider_circles.push(new SAT.Circle(the_point, radius));
                var end_ix = collider_circles.length-1;
                //console.log('collider_circles.length:', i,z);  

                place_stimuli(right,down,pics[counter],images[counter],counter); //place centered image
                counter += 1;
            }//end inner for
        }//end outer for
    }
		
		//----------------------
		//CALLED ONCE TO LOAD EACH IMAGE (BY DRAWSTUFF)
		//----------------------
    function place_stimuli(px_right,px_down,img_name,base_image,counter)
		{
      base_image = new Image();
      base_image.onload = function()
			{
      	context.drawImage(base_image, px_right - (this.width/2), px_down - (this.height/2));
      	//context.fillText("img/fish/" + img_name + ".png",px_right,px_down);
      }
			base_image.src = "img/fish/" + img_name + ".png";
			
			sounds[counter] = new Audio("img/fish/" + img_name + ".mp3");
			
    }
		
		//----------------------
		///CALLED EVERY FEW MS BASED ON setInterval 
		//----------------------
		function update(collider_circles,mouse_point)
		{
			var currRegion = -1; //reset the current region to null on each update
			var triggered = 0; //reset the trigger to null on each update

        for(var key in collider_circles)   //for each collider 
				{                
					var isColliding = SAT.pointInCircle(mouse_point, collider_circles[key]); //is the pointer in it?
						if(isColliding) //if so
						{
							currRegion = key; //set the current region = the collider number
            }
				}
       	if(currRegion>-1) //if the current region is not whitespace
				{
					document.title = currRegion; //change doc title 
				 	 if (currRegion != lastRegion)  //if the current region is DIFFERENT from the last region
						 { sounds[currRegion].play(); //TRIGGER THE SOUND! YAY!
							 triggered = 1; //note that it was triggered 
						 }																
       	 } 
				 else //if the current region IS whitespace
				 {
          document.title = "?"  //change the title 
       	 }
				 lastRegion = currRegion;  //prepare for next update by setting lastRegion = currentRegion
 				 console.log( Date.now(),",",mouse_point.x,",", mouse_point.y,",", parseInt(currRegion),",", triggered); //LOG ALL DATA TO CONSOLE
    }

    
// function drawCircle(px_right,px_down,radius)
// 		{
//         var c=document.getElementById("canvas");
//         var ctx=c.getContext("2d");
//         ctx.beginPath();
//         ctx.arc(px_right,px_down,radius,0,2*Math.PI);
//         ctx.stroke();
//}
 

})();

//figure out coordinate logging to file 
//timestamp, x, y, whatI'min, audiotrigger?
//look up visualizations for eye tracking data 


</script>
